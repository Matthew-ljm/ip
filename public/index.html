<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP信息发送服务</title>
    <style>
        /* 保持原有样式 */
        body { max-width: 600px; margin: 0 auto; padding: 20px; text-align: center; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        #status { margin-top: 20px; padding: 10px; border-radius: 4px; }
        .success { background: #dff0d8; color: #3c763d; }
        .error { background: #f2dede; color: #a94442; }
    </style>
</head>
<body>
    <h1>IP信息发送服务</h1>
    <button id="sendBtn">发送IP信息到邮箱</button>
    <div id="status"></div>
    
    <script>
        document.getElementById('sendBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('status');
            statusEl.textContent = '正在获取信息...';
            statusEl.className = '';
            
            try {
                // 1. 前端直接获取IP（使用无限制的接口）
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const { ip } = await ipResponse.json(); // 只获取IP，避免限流
                
                // 2. 前端直接获取本地时间（北京时间）
                const localTime = new Date().toLocaleString('zh-CN', {
                    timeZone: 'Asia/Shanghai',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                // 3. 构造完整信息（无需第三方地理信息，避免限流）
                const ipData = {
                    ip: ip,
                    localTime: localTime,
                    timezone: 'Asia/Shanghai',
                    browser: navigator.userAgent, // 可选：添加浏览器信息
                    language: navigator.language
                };
                
                statusEl.textContent = '正在发送邮件...';
                
                // 4. 发送到后端
                const sendResponse = await fetch('/api/send-ip', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ipData: ipData,
                        email: 'huifeidexiaogougou@126.com'
                    }),
                });
                
                const result = await sendResponse.json();
                if (sendResponse.ok) {
                    statusEl.textContent = '邮件发送成功！';
                    statusEl.className = 'success';
                } else {
                    throw new Error(result.error || '发送失败');
                }
            } catch (error) {
                statusEl.textContent = `错误: ${error.message}`;
                statusEl.className = 'error';
                console.error(error);
            }
        });
    </script>
</body>
</html>